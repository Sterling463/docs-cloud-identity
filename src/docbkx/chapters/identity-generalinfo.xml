<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE section [
<!ENTITY % common SYSTEM "../../common/common.ent">
%common;
]>

<chapter xmlns="http://docbook.org/ns/docbook"
    xmlns:xi="http://www.w3.org/2001/XInclude"
    xmlns:db="http://docbook.org/ns/docbook" 
    xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0"
    xml:id="Overview-Keystone-API-d1e62">
 
<title>General API Information</title>
    
	<para>
		The authentication service allows clients to obtain
		tokens that can be used to access cloud services such as those
		provided by Rackspace and OpenStack.</para>
	
	<para>The authentication service API is implemented using a ReSTful
			web service interface. All requests to authenticate and
			operate against the authentication service should be 
			performed using SSL over HTTP (HTTPS) on TCP port
			443.</para>
	
	<!--Note the Admin concepts section contains a workflow diagram not included in Dev guide.  
		That's why the xi:include content is conditional.-->
	
	<xi:include href="section_identity-concepts.xml"/>
	<section xml:id="Request_Response_Types-d1e149">
		<title>Request/Response Types</title>
		<para>The &CIS; v2 API supports both the JSON and XML data serialization request and response
			formats. Some operations also support the Atom Syndication Format for responses. If you
			do not specify a format type, JSON is the default. <xref linkend="Response_Types"/> provides 
			a summary of the available formats.</para>
		
		<table rules="all" width="884" xml:id="Response_Types">
			<caption>Supported Request and Response formats</caption>
			<col width="7%"/>
			<col width="35%"/>
			<col width="222pt"/>
			<col width="14%"/>
			<col width="160px"/>
			<thead valign="baseline">
				<tr>
					<td>Format</td>
					<th>Content-Type  header</th>
					<td>Accept header</td>
					<td>Query Extension for request URI</td>
					<td>Default</td>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>JSON</td>
					<td><code>Content-Type application/json</code></td>
					<td><code>application/json</code></td>
					<td>.json</td>
					<td>Yes</td>
				</tr>
				<tr>
					<td>XML</td>
					<td><code>Content-Type application/xml</code></td>
					<td><code>application/xml</code></td>
					<td>.xml</td>
					<td>No</td>
				</tr>
			</tbody>
		</table>
		<variablelist>
			<varlistentry>
				<term><guilabel>Content-Type header syntax</guilabel></term>
				<listitem>
					<para>You specify the request format in the <code>Content-Type</code> header. This header is
						required for operations that have a request body.  The following code sample shows the
						syntax for the <code>Content-Type</code> header:
					</para>
					<para>
						<programlisting>Content-Type: application/<parameter>format</parameter></programlisting>
					</para>
					<para>Where <parameter>format</parameter> is either <literal>json</literal> or <literal>xml</literal>.</para>
				</listitem>
			</varlistentry>
		</variablelist>
		<para>You can specify the response format using either the <code>Accept</code> header or a
			query extension:</para>
		<variablelist>
			<varlistentry>
				<term><guilabel>Accept header syntax</guilabel></term>
				<listitem>
					<para>
						<programlisting>Accept: application/format</programlisting> 
					</para>
					<para>Where <code>format</code> can be either <code>json</code> or 
						<code>xml</code>.</para>
				</listitem>
			</varlistentry>
			<varlistentry>
				<term><guilabel>Query extension syntax</guilabel></term>
				<listitem>
					<para>Add an <code>.xml</code> or <code>.json</code> extension to the request
						URI. For example, the <code>.xml</code> extension in the following URI
						request specifies that the response body is returned in XML format.</para>
					<para>
						<programlisting>POST /v2/tokens.xml</programlisting>
					</para>
					<para>
						If you specify different formats for the Accept header and the query extension, the format
						specified in the query extension takes precedence. For example, if the query
						extension is <code>.xml</code> and the Accept header specifies
						<code>application/json</code>, the response is returned in XML
						format.
					</para>
				</listitem>
			</varlistentry>
		</variablelist>
		<para>You can serialize a response in a different format from the request format. <xref linkend="JSON_req"/> and
			<xref linkend="diff-serialization"/> show a request body in JSON format and a response body in XML format. </para>
		<example xml:id="JSON_req">
			<title>Authentication Request with Headers: JSON</title>
			
			<programlisting language="json">
<![CDATA[&lt; &lt; POST /v2.0/tokens HTTP/1.1
Host: identity.api.rackspacecloud.com
Content-Type: application/json
Accept: application/json

{
  "auth": {
    "passwordCredentials": {
      "username": "demoauthor",
      "password": "mypass"
    },
    "tenantId": "1234"
  }
}]]>
</programlisting>
		</example>
		
		<para><xref linkend="diff-serialization"/> shows the headers and XML response returned by the JSON request.</para>
		<example xml:id="diff-serialization">
			<title>Response with Headers: XML</title>
			<programlisting>
<![CDATA[HTTP/1.1 200 OK
Date: Sun, 29 Jun 2014 03:35:05 GMT
Content-Type: application/xml
Content-Length: 1060
Connection: keep-alive
vary: Accept, Accept-Encoding, X-Auth-Token]]>
<![CDATA[
<access xmlns:atom="http://www.w3.org/2005/Atom" 
xmlns:rax-auth="http://docs.rackspace.com/identity/api/ext/RAX-AUTH/v1.0" 
xmlns="http://docs.openstack.org/identity/api/v2.0" 
xmlns:ns4="http://docs.rackspace.com/identity/api/ext/RAX-KSGRP/v1.0" 
xmlns:rax-ksqa="http://docs.rackspace.com/identity/api/ext/RAX-KSQA/v1.0" 
xmlns:os-ksadm="http://docs.openstack.org/identity/api/ext/OS-KSADM/v1.0" 
xmlns:rax-kskey="http://docs.rackspace.com/identity/api/ext/RAX-KSKEY/v1.0" 
xmlns:os-ksec2="http://docs.openstack.org/identity/api/ext/OS-KSEC2/v1.0">
     <token id="yyyyxxxaxxxxyyyyyyxxxxxxxyyyyy" expires="2014-06-29T21:09:34.085Z">
          <rax-auth:authenticatedBy>
               <rax-auth:credential>PASSWORD</rax-auth:credential>
          </rax-auth:authenticatedBy>
     </token>
     <user name="demoauthor" rax-auth:defaultRegion="DFW" rax-auth:federated="false">
          <roles>
               <role id="1" name="identity:admin" description="Admin Role."/>
          </roles>
     </user>
     <serviceCatalog/>
</access>]]>
			</programlisting>
		</example>
	</section>
	
    <xi:include href="section-authReqResp.xml"/>
	<section xml:id="Content_Compression-d1e262">
	  <title>Content Compression</title>
	  <para>Request and response body data may be encoded with gzip
			compression in order to accelerate interactive performance
			of API calls and responses. This is controlled using the
				<code>Accept-Encoding</code> header on the request
			from the client and indicated by the
				<code>Content-Encoding</code> header in the server
			response. By default, encoding is disabled.</para>
	  <table rules="all">
		<caption>Compression Headers</caption>
		<thead>
		  <tr>
			<td>Header Type</td>
			<td>Name</td>
			<td>Value</td>
		  </tr>
		</thead>
		<tbody>
		  <tr>
			<td>HTTP/1.1 Request</td>
		  	<td><code>Accept-Encoding</code></td>
			<td>gzip</td>
		  </tr>
		  <tr>
			<td>HTTP/1.1 Response</td>
		  	<td><code>Content-Encoding</code></td>
			<td>gzip</td>
		  </tr>
		</tbody>
	  </table>
	</section>
	<section security="writeronly" xml:id="Paginated_Collections-d1e325">
		<title>Paginated collections</title>
		<annotation>
			<remark>"Paginated Collections" is not yet implemented as of v2.0;
				hide it for now and reveal it when the feature is working." </remark>
		</annotation>
		<para>To reduce load on the service, list operations return a
			maximum number of items at a time. The maximum number of
			items returned is determined by the Identity provider. To
			navigate the collection, the parameters
				<parameter>limit</parameter> and
				<parameter>marker</parameter> can be set in the URI
				(e.g.?<parameter>limit</parameter>=100&amp;<parameter>marker</parameter>=1234).
			The <parameter>marker</parameter> parameter is the ID of
			the last item in the previous list. Items are sorted by
			update time; when an update time is not available, they
			are sorted by ID. The <parameter>limit</parameter>
			parameter sets the page size. Both the
				<parameter>limit</parameter> and
				<parameter>marker</parameter> parameters are optional.
			If the client requests a <parameter>limit</parameter>
			beyond that which is supported by the deployment, an
			<literal>overLimit</literal> (<errorcode>413</errorcode>) fault may be
			thrown. A <parameter>marker</parameter> with an invalid ID
			will return an <literal>itemNotFound</literal> (<errorcode>404</errorcode>)
			fault. </para>
		<note>
			<para>
				Paginated collections never return <code>itemNotFound</code> (<errorcode>404</errorcode>) faults when the
				collection is empty; clients should be prepared to
				handle an empty collection.</para>
		</note>
		<para>Paginated collections contain "next" and "previous"
			Atom links. The first page in the list will not contain a
			"previous" link; similarly, the last page in the list will
			not contain a "next" link. 
		</para>
		<para>
			In the following examples, a paginated collection of tenants
			is returned as three linked pages. 
			The
			first page is retrieved via a &GET; to
			<code>http://identity.api.openstack.org/v2.0/1234/tenants?limit=1</code>;
			the second page is retrieved by following the "next" link from the first page;
			the third page is retrieved by following the "next" link from the second page.
		</para>	
		<para>	
			The <parameter>limit</parameter>
			parameter sets the page size;
			<parameter>limit=1</parameter> returns one item on the first page. Subsequent
			"next" and "previous" links honor the initial page
			size. Thus, a client may follow links to traverse a
			paginated collection without having to input the
				<parameter>marker</parameter> parameter. </para>
		<example>
			<title>Tenant Collection, First Page: XML</title>
			<programlisting language="xml">
<xi:include href="../samples/tenants-1.xml" parse="text"/>
			</programlisting>
		</example>
		<example>
			<title>Tenant Collection, First Page: JSON</title>
			<programlisting language="javascript"><xi:include
			href="../samples/tenants-1.json" parse="text"/></programlisting>
		</example>
		<example>
			<title>Tenant Collection, Second Page: XML</title>
			<programlisting language="xml">
<xi:include href="../samples/tenants-2.xml" parse="text"/>
			</programlisting>
		</example>
		<example>
			<title>Tenant Collection, Second Page: JSON</title>
			<programlisting language="javascript"><xi:include
			href="../samples/tenants-2.json" parse="text"/></programlisting>
		</example>
		<example>
			<title>Tenant Collection, Last Page: XML</title>
			<programlisting language="xml">
<xi:include href="../samples/tenants-3.xml" parse="text"/>
			</programlisting>
		</example>
		<example>
			<title>Tenant Collection, Last Page: JSON</title>
			<programlisting language="javascript"><xi:include
			href="../samples/tenants-3.json" parse="text"/></programlisting>
		</example>
		<para>
			In the JSON representation, paginated collections contain
			a <property>values</property> property that contains the
			items in the collections.  Links are accessed via the
			<property>links</property> property. This approach allows
			for extensibility of both the collection members and of
			the paginated collection itself. It also allows
			collections to be embedded in other objects as shown in the example 
			below. Here, a subset of groups is presented within a
			user. To continue retrieving 
			additional groups belonging to a user, a client must follow the "next" link.
		</para>
		<example>
			<title>Paginated Roles in a User: XML</title>
			<programlisting language="xml">
<xi:include href="../samples/getuser-1.xml" parse="text"/>
			</programlisting>
		</example>
		<example>
			<title>Paginated Roles in a User: JSON</title>
			<programlisting language="javascript"><xi:include
			href="../samples/getuser-1.json" parse="text"/></programlisting>
		</example>
	</section>
	<section xml:id="Versions-d1e472">
		<title>Contract versions</title>
		<para>The contract version denotes the data model and behavior that the API supports.
			The identity API uses a URI version scheme.</para>
		<important>
			<para>The Rackspace implementation of the OpenStack Keystone Identity
				Service v2.0 does not
				yet support MIME-type version. </para>
		</important>
		<para>
			The first element of
			the URI path contains the target version identifier. For example, this URI targets API version 2.0: 
			&ENDPOINT-US;&hellip;. Other than requests to query for version, all requests must contain a target version. 
		</para>
	    <para>
			Any features or functionality
			changes that would necessitate a break in API compatibility will require a new
			version, which will result in the URI version being updated accordingly. When new
			API versions are released, older versions will be marked as <code>DEPRECATED</code>.
			Rackspace will work with developers and partners to ensure that there is adequate time to
			migrate to the new version before deprecated versions are discontinued. </para>
		<para security="writeronly">
			The authentication service API uses two version schemes, one based on the URI 
			and the other based on MIME type.
			<annotation>
				<remark>MIME-type version support has not been implemented in v2.0;
					meanwhile, using URI-only text borrowed from Auth
					1.1. </remark>
			</annotation>
			<itemizedlist>
				<listitem>
					<para>			
						In the URI version scheme, the first
						element of the path contains the target version
						identifier. For example, in <code>https://identity.api.openstack.org/
						v2.0/&hellip;</code>, the target version is identified as <code>v2.0</code>. 
					</para>
				</listitem>	
				<listitem>
					<para>
						The MIME-type version scheme uses
						HTTP content negotiation where the <code>Accept</code>
						or <code>Content-Type</code> header contains a MIME
						type that includes the version ID as a parameter.
						For example, in <code>
						application/vnd.openstack.identity+xml;version=1.1</code>, 
						the target version is identified as <code>1.1</code>. 
						A version MIME type is always linked to a base MIME type
						such as <code>application/xml</code> or <code>application/json</code>. 
					</para>
				</listitem>
			</itemizedlist>
			If conflicting
			versions are specified using both a MIME type and a
			URI, the URI takes precedence.
		</para>
		<example security="writeronly">
			<title>Request with MIME-Type version scheme</title>
			<literallayout class="monospaced">
GET /tenants HTTP/1.1
Host: identity.api.rackspacecloud.com
Accept: application/vnd.openstack.identity+xml;version=1.1
X-Auth-Token: eaaafd18-0fed-4b3a-81b4-663c99ec1cbb
			</literallayout>
		</example>
		<example>
			<title>Request with URI version scheme</title>
			<literallayout class="monospaced">
GET /v2.0/tenants HTTP/1.1
Host: identity.api.rackspacecloud.com
Accept: application/xml
X-Auth-Token: eaaafd18-0fed-4b3a-81b4-663c99ec1cbb
			</literallayout>
		</example>
		<note security="writeronly">
			<para>
				The MIME-type version approach supports the
				creation of permanent links, because the version
				scheme is not specified in the URI path. For example, 
				<code>https://api.identity.openstack.org/tenants/12234</code>
				identifies a list of tenants associated with <code>12234</code> but does not identify a version.
			</para>
		</note>
		<para security="writeronly">
			If a request is made with no version specified, then a multiple-choices
			response (<returnvalue>300</returnvalue>) will follow,
			providing links and MIME types for available versions.
		</para>
		<example security="writeronly">
			<title>Multiple Choices Response: XML</title>
			<programlisting language="xml">
<xi:include href="../samples/choices.xml" parse="text"/>
			</programlisting>
		</example>
		<example security="writeronly">
			<title>Multiple Choices Response: JSON</title>
			<programlisting language="javascript"><xi:include href="../samples/choices.json" parse="text"/></programlisting>
		</example>
		<para>Features or functionality changes that would disrupt API
			compatibility will require a new version, which will
			result in the URI version being updated accordingly. When
			new API versions are released, older versions will be
			marked as <code>DEPRECATED</code>. Providers should work
			with developers and partners to ensure there is adequate
			time to migrate to the new version before deprecated
			versions are discontinued. <itemizedlist>
				<listitem>
					<para> New features and functionality that do not
						break API compatibility will be introduced in
						the current version of the API as <link
							linkend="Extensions-d1e688"
							>extensions</link> and the URI will remain
						unchanged. </para>
				</listitem>
				<listitem>
					<para>Features or functionality changes that would
						disrupt API compatibility will require a new
						version, which will result in the URI version
						being updated accordingly. </para>
				</listitem>
				<listitem>
					<para>When new API versions are released, older
						versions will be marked as
							<code>DEPRECATED</code>. </para>
				</listitem>
			</itemizedlist></para>
		<para>
			You can programmatically determine
			available API versions by performing a &GET; on the
			root URL returned from the
			authentication system. In the root URL, the version and everything to the
			right of it is truncated.
			An Atom
			representation of the version's resources is supported
			when issuing a request with the <code>Accept</code>
			header containing <code>application/atom+xml</code> or by adding 
			<code>.atom</code> to the request URI.  This allows standard Atom
			clients to track version changes.
		</para>
		<example>
			<title>Versions List Request</title>
			<literallayout class="monospaced">
GET HTTP/1.1
Host: identity.api.rackspacecloud.com
			</literallayout>
		</example>
		<simpara>&CODES; <returnvalue>200</returnvalue>, <returnvalue>203</returnvalue></simpara>
		<simpara>&ERROR_CODES; badRequest
		(<errorcode>400</errorcode>), identityFault
		(<errorcode>500</errorcode>),
		serviceUnavailable(<errorcode>503</errorcode>)</simpara>
		&NO_REQUEST;
		<example>
			<title>Versions List Response: XML</title>
			<programlisting language="xml">
<xi:include href="../samples/versions.xml" parse="text"/>
			</programlisting>
		</example>
		<example>
			<title>Versions List Response: Atom</title>
			<programlisting language="xml">
<xi:include href="../samples/versions-atom.xml" parse="text"/>
			</programlisting>
		</example>
		<example>
			<title>Versions List Response: JSON</title>
			<programlisting language="javascript"><xi:include href="../samples/versions.json" parse="text"/></programlisting>
		</example>
		<para>You can obtain additional detailed information about a specific version by performing a
			&GET; on the base version URL. For example,
				<code>https://identity.api.rackspacecloud.com/v2.0/</code> is a base version URL, in
			which <code>v2.0</code> is the initial version of the API. All version request URLs end
			with a trailing slash (/). If the slash is omitted, the server might respond with a
				<returnvalue>302</returnvalue> redirection request. You can add format extensions
			after the trailing slash. For example, <code> &ENDPOINT-US;.xml</code> includes
				<code>.xml</code> as a format extension. Note that this is a special case that does
			not hold true for other API requests. In general, requests such as
				<code>/tenants.xml</code> and <code>/tenants/.xml</code> are handled equivalently. </para>
		<example>
			<title>Version Details Request</title>
			<literallayout class="monospaced">
GET HTTP/1.1
Host: identity.api.rackspacecloud.com/v1.0/
			</literallayout>
		</example>
		<simpara>&CODES; <returnvalue>200</returnvalue>, <returnvalue>203</returnvalue></simpara>
		<simpara>&ERROR_CODES; badRequest
		(<errorcode>400</errorcode>), identityFault
		(<errorcode>500</errorcode>),
		serviceUnavailable(<errorcode>503</errorcode>)</simpara>
		&NO_REQUEST;
		<example>
			<title>Version Details Response: XML</title>
			<programlisting language="xml">
<xi:include href="../samples/version.xml" parse="text"/>
			</programlisting>
		</example>
		<example>
			<title>Version Details Response: Atom</title>
			<programlisting language="xml">
<xi:include href="../samples/version-atom.xml" parse="text"/>
			</programlisting>
		</example>
		<example>
			<title>Version details response: JSON</title>
			<programlisting language="javascript"><xi:include href="../samples/version.json" parse="text"/></programlisting>
		</example>
		<para>
			The detailed version response contains pointers to
			both a human-readable and a machine-processable
			description of the API service. The machine-processable description is written in the Web
			Application Description Language (WADL).
		</para>
		<note>
			<para>If there is a discrepancy between the two specifications, the WADL is
			authoritative as it contains the most accurate and up-to-date description of the
			API service. </para>
		</note>
	</section>
	<xi:include href="section-extensions.xml"/>
	<xi:include href="section-namespaces.xml"/>
	<section xml:id="Account-Users-d1e910">
		<title>Identity user types and default roles</title>
		
		<para>In the &CLOUD;, users are represented as accounts created for specific individuals.
			Typically, a user has a password and email associated with the account. When a user is
			created, the &CIS; automatically assigns a user type and a default role to the account,
			based on the default &CIS; system configuration. The role defines access rights and
			permissions for the &CIS; and other &CLOUD; services as shown in <xref
				linkend="Identity_tbl_usr"/>.
		</para>
		<table xml:id="Identity_tbl_usr " rules="all" width="958">
			<caption>&CIS; Accounts: User types and default role assignments</caption>
			<col width="15%"/>
			<col width="17%"/>
			<col width="686pt"/>
			<thead>
				<tr>
					<th>
						<para>User type</para>
					</th>
					<th>
						<para>Default role assignment</para>
					</th>
					<th>
						<para>Description</para>
					</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>
						<para>Service administrator</para>
					</td>
					<td>
						<para>identity:service-admin</para>
					</td>
					<td>
						<para>The Service administrator user type is reserved for the &CIS; operations team members.
							Service administrators hold the
								<literal>identity:service-admin</literal> role that provides full
							administrative rights and privileges to manage the Identity service. </para>
						<para>Service developers that want to update an existing &CLOUD; service or add a new one work
							together with the &CIS; Operations team to create an endpoint template
							and add the service to the Service catalog. </para>
					</td>
				</tr>
				<tr>
					<td>
						<para>Administrator</para>
					</td>
					<td>
						<para>identity:admin</para>
					</td>
					<td>
						<para>The Administrator user type is reserved for &CLOUD; services that
							require access to the &CIS; to validate tokens and retrieve user
							information.</para>
					</td>
				</tr>
				<tr>
					<td>
						<para>User Administrator</para>
						<para>(Account owner)</para>
					</td>
					<td>
						<para>identity-user-admin</para>
					</td>
					<td>
						<para>When a &CLOUD; customer account is created, it is associated with one
							user, the User administrator.</para>
						<para>The &CIS; automatically assigns the
								<literal>identity:user-admin</literal>
							role to the account, giving the User
							Administrator full administrative
							privileges to manage the administrative
							account and all sub-user accounts created
							as children of the User administrator
							account. Exactly one administrative user
							exists for each account. The User
							Administrator account user is also
							referred to as the Account Owner.</para>
					</td>
				</tr>
				<tr>
					<td>
						<para>Account User</para>
						<para>(sub-user)</para>
					</td>
					<td>
						<para>identity:default</para>
					</td>
					<td>
						<para>Account users, sometimes called sub-users, are created and managed by
							User administrators. An account user has these characteristics:</para>
						<itemizedlist>
							<listitem>
								<para>Their account is a child of the User Administrator
									account.</para>
							</listitem>
							<listitem>
								<para>Hold the <literal>identity:default</literal> role, with the associated rights and
									privileges.</para>
							</listitem>
							<listitem>
								<para>Share the tenant information, group memberships, and endpoints
									from the parent User Administrator account.</para>
							</listitem>
						</itemizedlist>
						<para>The <literal>identity:default</literal> role only provides rights and privileges to
							manage the user's own account. For example, account users can update
							user information and passwords on their own accounts, but they cannot
							update information on other accounts. An account user can submit a List
							users request, but the response only returns information about the
							account owner. </para>
						<para>Administrators can directly assign sub-users to a particular tenant so
							that the users behave as if they are contained within that tenant
						</para>
					</td>
				</tr>
				<tr>
					<td>User Manager</td>
					<td>identity:user-manage</td>
					<td>
						   <para>The User manager is a customer-based
								user type designated as an
								administrator on a &CLOUD; account
								along with the User
								administrator.</para>
							<para>User Manager accounts hold the
								<literal>user-admin</literal> role
								by default, with the same access
								rights and privileges as the User
								administrator.</para>
							<para>User and Service administrators can
								update an existing or new sub-user
								account with the
								<literal>identity:default</literal>
								role to change the account to a User
								Manager account.</para>
						</td>
				</tr>
			</tbody>
		</table>
		<para><?oxy_comment_start author="marg7175" timestamp="20140612T001831-0500" comment="Does the section about valid authentication credentials require update?"?>All<?oxy_comment_end?>
			users, including account users, can authenticate with a combination of their user name
			and password. Only administrative users can authenticate either with a combination of
			their user name and API key or with a combination of their tenant ID and API key.</para>
			<note>
				<para>When managing &amp;CIS; accounts for the User Administrator, keep the following points in
				mind to prevent unexpected changes to the sub-user accounts associated with the User
				Administrator account. <itemizedlist>
					<listitem>
						<para> When a new account user is created, it inherits its parent's groups.
						</para>
					</listitem>
					<listitem>
						<para> When a parent is assigned to a new group, its account users inherit
							that group. </para>
					</listitem>
					<listitem>
						<para> When a parent is removed from a group, its account users are removed,
							too. </para>
					</listitem>
					<listitem>
						<para> When a service attempts to assign an account user to a group, that
							attempt fails. A <errorcode>400</errorcode> error is returned, with the
							following message: "Cannot add sub-users directly to a group, must
							assign their parent user." To assign an account user to a group, assign
							its parent to that group; the account user will inherit the new group
							assignment from its parent. </para>
					</listitem>
					<listitem>
						<para>Administrators can directly assign Account users to a particular
							tenant so that the users behave as if they are contained within that
							tenant.</para>
					</listitem>
				</itemizedlist></para>
			</note> 
	</section>
	<xi:include href="section-identity-multfactorauth-client.xml"/>
	<section xml:id="Limits-d1e909">
		<title>Limits</title>
		<para>
			Calls to the Identity API are rate-limited at a default of 50 requests per second. 
			Since tokens have an expiration time of 24 hours, you should never hit this limit.
		</para>
		<para>
			The limit is placed on either the request's IP address, the user name, or the token 
			in the <code>X-Auth-Token</code> header, depending on the data available in the call's request.
			If your request is rejected because you have exceeded your rate limit, you will receive a <errorcode>413</errorcode> <code>overLimit</code> error. 
			While you can retry after a few seconds, 
			we also recommend that you check your client code to verify that it is using the API in an efficient manner.
		</para>
		<para>
			A future release will provide the ability to view your limits so you can track API utilization before being rate-limited.
		</para>
		<para>
			The rate limit defaults are likely to change as we gauge realistic levels.  
			If the default limits change, we'll update this document to reflect the current value.
		</para>
		<tip condition="admin">
			<para> You can learn about rate limiting operations in <olink
					targetdoc="Identity-Admin-Developer-Guide"
					targetptr="Ratelimiting_Calls">“Rate
					Limits”</olink>. </para>
		</tip>
	</section>
	<section xml:id="Faults-d1e908">
		<title>Faults</title>
		<para>
			When an error occurs, the system returns an HTTP error response code denoting the type of error. The system 
			returns additional information about the fault in the body of the response. 
		</para>
		<para>
			The following table lists possible fault types along with their associated error codes. 
		</para>
		<table rules="all">
			<caption>Fault Types</caption>
			<thead>
				<tr>
					<td>Fault Element</td>
					<td>Associated Error Codes</td>
					<td>Expected in All Requests?</td>
				</tr>
			</thead>
			<tbody>
				<tr align="left">
					<td>serviceFault</td>
					<td>500</td>
					<td> YES </td>
				</tr>
				<tr>
					<td>serviceUnavailable</td>
					<td>503</td>
					<td/>
				</tr>
				<tr align="left">
					<td>badRequest</td>
					<td>400</td>
					<td> YES </td>
				</tr>
				<tr align="left">
					<td>unauthorized</td>
					<td>401</td>
					<td> YES </td>
				</tr>
				<tr align="left">
					<td><link linkend="Limits-d1e909"
							>overLimit</link></td>
					<td>413</td>
					<td> YES</td>
				</tr>
				<tr align="left">
					<td>userDisabled</td>
					<td>403</td>
					<td/>
				</tr>
				<tr align="left">
					<td>forbidden</td>
					<td>403</td>
					<td/>
				</tr>
				<tr align="left">
					<td>itemNotFound</td>
					<td>404</td>
					<td/>
				</tr>
				<tr align="left">
					<td>tenantConflict</td>
					<td>409</td>
					<td/>
				</tr>
			</tbody>
		</table>
		<para> The root element of the fault can change depending on the type of error. From an XML schema
			perspective, all API faults are extensions of the base fault type,
				<type>identityFault</type>. When working with a system that binds XML to actual
			classes, use <type>identityFault</type> as a catch-all if there is no interest in
			distinguishing between individual fault types; for example, you might need to do this if
			you are working with JAXB. </para>
  		<para> The error code is returned in the body of the response. The message section returns a
			human-readable message. The details section is optional and may contain useful
			information for tracking down an error. For example, a stack trace might be provided. </para>
  		<para> 
  			The following are examples of an <code>itemNotFound</code> error. 
  		</para>
		<example>
			<title>Item Not Found Fault: XML</title>
			<programlisting language="xml">
				<xi:include href="../samples/item_not_found.xml" parse="text"/>
			</programlisting>
		</example>
		<example>
			<title>Item Not Found Fault: JSON</title>
			<programlisting language="javascript">
				<xi:include href="../samples/item_not_found.json" parse="text"/>
			</programlisting>
		</example>
	</section>
	<section xml:id="Role_Based_Access_Control-d1e808">
		<title>Role Based Access Control</title>
		<para>The Rackspace Cloud Identity service provides Role Based Access Control (RBAC) so that
			customers can restrict access to Cloud services and capabilities to authorized users
			only. RBAC is an opt-in feature available to all Rackspace Cloud customers. The account
			owner user (<literal>identity:user-admin</literal>) can activate RBAC by adding users to
			the account and assigning roles to users via the API, the Cloud Control Panel, or by
			calling Customer support. </para>
		
		<para>
			Rackspace-defined roles provide specific permissions that determine the services a user can
			access and the types of operations they can complete. For example, an account owner can assign 
			an <literal>admin</literal> role to user accounts that require access to create, read, update, and delete 
			capabilities for all API services included in the service catalog for that account. 
		</para>
		
		<para>
			Role assignments can be global or custom. Global roles manage access and permissions across 
			multiple API services. Custom roles manage access and permissions on a per-product basis. 
			For both global and custom roles, the user has access only to designated products. 
			<xref linkend="RBAC_roledesc_tbl"/> describes the
			RBAC roles available.</para> 
		<table rules="all" width="100%" xml:id="RBAC_roledesc_tbl">
				<caption>Rackspace Cloud RBAC Roles and Capabilities</caption>
				<thead>
					<tr>
						<th>Role</th>
						<th>Type</th>
						<th>Role Description</th>
						<th>Example Role</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>admin (full access)</td>
						<td>Global</td>
						<td>The admin role provides Create, Read, Update, and Delete permissions
							in all Cloud products, where access is granted. Full access is given
							to current and future products as they become RBAC-enabled. Each
							account can have only one admin </td>
						<td>admin</td>
					</tr>
					<tr>
						<td>observer (read-only access)</td>
						<td>Global</td>
						<td>The observer role provides Read permission in all products where
							access is granted. Read-only access is given to current and future
							products as they become RBAC-enabled.</td>
						<td>observer</td>
					</tr>
					<tr>
						<td>product:admin</td>
						<td>Custom</td>
						<td>The product:admin role provides Create, Read, Update, and Delete
							permissions for a specified product, where access is granted.</td>
						<td>nova:admin</td>
					</tr>
					<tr>
						<td>product:creator</td>
						<td>Custom</td>
						<td>The product:creator role provides Create, Read, and Update
							permissions for a specified product, where access is granted. The
							user cannot delete resources.</td>
						<td>cloudFiles:creator</td>
					</tr>
					<tr>
						<td>product:observer</td>
						<td>Custom</td>
						<td>This product:observer role provides Read permission for a specified
							product, where access is granted.</td>
						<td>cdb:observer</td>
					</tr>
				</tbody>
			</table><important>
				<para xml:id="Account_Owner-dle808">All RBAC roles are subordinate to the account owner user
				(identity:user-admin) designated by the customer as the primary contact. Only an
				account owner can create account users (identity:default) and assign RBAC roles. Account owners 
				cannot hold any additional roles because they already have full access to all services and 
				capabilities.</para>
			</important>
		<section xmlns="http://docbook.org/ns/docbook"
			xmlns:xi="http://www.w3.org/2001/XInclude"
			xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0"
			xml:id="section_assign_roles_3">
			<title>Assigning Roles to Account Users</title>
			<para>The account owner, <literal>identity:user-admin</literal>) can create account users, 
				<literal>identity:default)</literal> on the account and then assign roles to 
				those users. The roles grant the account users specific permissions for accessing the 
				Cloud services and capabilities. Each account has only one account owner, and that role 
				is assigned by default to any Rackspace Cloud account when the account is created. Account 
				owners cannot hold any additional roles because they already have full access to all services 
				and capabilities.
			</para>
			<para>
				You can assign roles programmatically through the API or by using the Cloud Control panel
				interface.
			</para>
			<para>Use the following API operations to add account users and manage role assignments:</para>
			<itemizedlist>
				<listitem>
					<para>
						<link xlink:href="POST_addUser__v2.0_users_User_Calls.html">Add account user</link>
					</para>
				</listitem>
				<listitem>
					<para>
						<link xlink:href="PUT_addUserRole__v2.0_users__userId__roles_OS-KSADM__roleid__Role_Calls.html">
						Assign role to account users</link></para>
				</listitem>
				<listitem>
					<para>
						<link xlink:href="DELETE_deleteUserRole__v2.0_users__userId__roles_OS-KSADM__roleid__Role_Calls.html">Delete role from account user</link></para>
				</listitem>
			</itemizedlist>
			<para>For information about implementing RBAC by using the Cloud
				Control panel and other RBAC-related topics, see the
				following Rackspace Knowledge Center articles:</para>
			<itemizedlist>
				<listitem>
				<para>
					<link
						xlink:href="http://www.rackspace.com/knowledge_center/article/managing-role-based-access-control-rbac"
						>Managing Role-based access control through Cloud Control panel</link>
				</para>
			</listitem>
				<listitem>
					<para>
						<link
							xlink:href="http://www.rackspace.com/knowledge_center/article/getting-started-with-role-based-access-control-rbac-0">Getting Started with Role-based access control (RBAC)</link>
					</para>
				</listitem></itemizedlist>
		</section>
		<section xml:id="RBAC_Role_Conflict-dle808">
			<title>Resolving Conflicts Between RBAC Multiproduct (Global) vs. Custom (Product) Roles</title>
			<para>The account owner can set roles for both multiproduct and custom (product-specific) scope,
				and it is important to understand how any potential conflicts among these roles are
				resolved. When two roles appear to conflict, the role that provides the more
				extensive permissions takes precedence. Therefore, admin roles take precedence over
				observer roles, because admin roles provide more permissions. </para>
			<para>
				The following table shows two examples of how potential conflicts between user roles in the Control Panel are resolved:
			</para>
			<para>
				<informaltable rules="all">		
					<thead>
						<tr align="center">
							<td>Permission Configuration</td>
							<td>View of Permission in the Control Panel </td>
							<td>Can the User Perform Product Admin Functions in the Control Panel?</td>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td>User is assigned the following roles: multiproduct <emphasis role="bold">observer</emphasis> and product <emphasis
								role="bold">admin</emphasis></td>
							<td>Appears that the user has only the multiproduct <emphasis role="bold">observer</emphasis> role</td>
							<td>Yes, for specified product only. The user has the <emphasis role="bold">observer</emphasis> role for the rest of
								the products.</td>
						</tr>
						<tr>
							<td>User is assigned the following roles: multiproduct <emphasis role="bold">admin</emphasis> and product <emphasis
								role="bold">observer</emphasis></td>
							<td>Appears that the user has only the multiproduct <emphasis role="bold">admin</emphasis> role</td>
							<td>Yes, for all of the products. The specified product <emphasis role="bold">observer</emphasis> role is
								ignored.</td>
						</tr>
					</tbody>
				</informaltable>
			</para>
				<para>For information about using RBAC with specific products, see the 
					<link xlink:href="http://docs.rackspace.com/">API Developer Guide</link> for each product.</para>
			
		</section>
	</section>
    </chapter>
