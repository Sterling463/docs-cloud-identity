<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE glossary [
<!ENTITY % common SYSTEM "../../common/common.ent">
%common;
]>
<section xmlns="http://docbook.org/ns/docbook"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  xmlns:xsdxt="http://docs.rackspacecloud.com/xsd-ext/v1.0"
  xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" 
  xml:id="Sample_Request_Response-d1e64">
		<title>Authentication request and response</title>
		<para>The sample request and response in this section illustrate a
			general case. In your authentication request, use your own
			credentials rather than the sample values shown here for
				<code>user name</code>, <code>password</code>. and
				<code>tenantId</code>. When you authenticate
			successfully, the response to your authentication request
			will include a catalog of the services to which you have
			subscribed rather than the sample values shown here. </para>
	<para>The authenticate operation provides clients with an
		authentication token and a list of regional cloud endpoints.
		The sample requests and responses in this section illustrate a
		general case. In your authentication request, use your own
		credentials rather than the sample values shown here for
		username and apiKey. When you authenticate successfully, the
		response to your authentication request includes a catalog of
		the services to which you have subscribed rather than the
		sample values shown here.</para>
			<note><title>Notes</title>
				<itemizedlist>
					<listitem>
						<para>For information about other authentication methods with examples, 
							see <link xlink:href="Token_Calls.html">Authentication tokens</link>.</para></listitem>
					<listitem>
						<para>If a user account has been set up to use multi-factor
					authentication, the Identity service sends a
					passcode to the phone associated with the account
					and returns a 401 response in response to valid
					login credentials. To complete the authentication
					request, you need to supplly the multi-factor
					authentication Session ID and passcode
					credentials. For details, see <link
						xlink:href="proc_mfa_auth.html">Authenticate
						from a multifactor-enabled user
						account.</link>. </para>
				</listitem>
				</itemizedlist>
			</note>
		
	  <example>
		<title>Authentication Request with Headers: JSON</title>
	  	
		<programlisting language="json">
<![CDATA[POST /v2.0/tokens HTTP/1.1
Host: identity.api.rackspacecloud.com
Content-Type: application/json
Accept: application/json

{
  "auth": {
    "passwordCredentials": {
      "username": "demoauthor",
      "password": "mypass"
    },
    "tenantId": "1234"
  }
}]]>
</programlisting>
	  </example>
		<para><xref linkend="auth_req_attributes"></xref> describes the attributes for the authentication response.</para>
		<table rules="all" xml:id="auth_req_attributes">
			<caption>Authentication request attribute descriptions</caption>
			<col width="24%"/>
			<col width="76%"/>
			<thead>
				<tr>
					<th valign="top">Attribute</th>
					<th>Description</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td><parameter>username</parameter></td>
					<td>
						<para> 
							This is the user name you use to login to the Rackspace
							Cloud Control Panel at 
							<link xlink:href="http://mycloud.rackspace.com/">http://mycloud.rackspace.com</link></para>
					</td>
				</tr>
				<tr>
					<td><parameter>password</parameter></td>
					<td>
						<para>The password you use to login to the Rackspace Cloud
            Control Panel. The password must meet the following
            criteria:</para>
						<itemizedlist>
							<listitem><para>Length must be at least 8 characters; no maximum.</para></listitem>
							<listitem><para>Includes at least one uppercase and one lower case character.</para></listitem>
							<listitem><para>Can include special characters.</para></listitem>
							<listitem><para>Cannot begin with a space.</para></listitem>			
						</itemizedlist>
					</td>
				</tr>
				<tr>
					<td><parameter>tenantId</parameter></td>
					<td>
						<para>Tenant is an optional specification. Some services use
            multi-level authentication, with service-specific
            credentials in addition to vendor-specific credentials. In
            such cases, associating a user with a tenant can be a
            method of passing that additional level of identifying
            information to the service.</para>
					</td>
				</tr>
				
			</tbody>
		</table>			
		<para>A successful authentication response includes a token ID and a
		catalog of available services. For each service in the
		catalog, only relevant details are returned. Service
		descriptions vary depending on how the service has been
		configured. For example, some service endpoints might be
		associated with a default region. For those services, the
			<code>region</code> specification is included in the
		description. If the service endpoint does not have a default
		region defined, the service description does not include
			<code>region</code>.</para>
		<para><xref linkend="xml_auth_resp"/> and <xref
			linkend="json_auth_resp"/> show sample responses in XML
		and JSON format. In these examples, the authentication token
		returned provides access to the following services: <itemizedlist>
			<listitem>
				<para>Compute: Cloud Servers OpenStack and Cloud
					Servers</para>
			</listitem>
			<listitem>
				<para>Object storage: Cloud Files Content Distribution
					Service (CDN) and Cloud Files.</para>
			</listitem>
			<listitem>
				<para>Cloud Databases</para>
			</listitem>
			<listitem>
				<para>Cloud DNS</para>
			</listitem>
			<listitem>
				<para>Cloud Load Balancers</para>
			</listitem>
			<listitem>
				<para>Cloud Monitoring</para>
			</listitem>
		</itemizedlist>The catalog listing for each service provides
		the URL for the API endpoint to access the service, along with
		information about the API version, and the region or tenant,
		if applicable. For information about the attributes included
		in the response, see <xref linkend="auth_attributes"/>.</para>
	  <example xml:id="xml_auth_resp">
		<title>Service Catalog in Authentication Response with Headers: XML</title>
		<programlisting language="xml">
<![CDATA[< HTTP/1.1 200 OKAY
Date: Mon, 12 Nov 2010 15:55:01 GMT
Content-Length:
Content-Type: application/xml; charset=UTF-8
<access 
    xmlns:rax-auth="http://docs.rackspace.com/identity/api/ext/RAX-AUTH/v1.0" 
    xmlns:os-ksadm="http://docs.openstack.org/identity/api/ext/OS-KSADM/v1.0"
    xmlns="http://docs.openstack.org/identity/api/v2.0"
    xmlns:rax-kskey="http://docs.rackspace.com/identity/api/ext/RAX-KSKEY/v1.0"
    xmlns:rax-ksqa="http://docs.rackspace.com/identity/api/ext/RAX-KSQA/v1.0"
    xmlns:common="http://docs.openstack.org/common/api/v1.0"
    xmlns:ksgrp="http://docs.rackspace.com/identity/api/ext/RAX-KSGRP/v1.0"
    xmlns:rax-kscatalog="http://docs.openstack.org/identity/api/ext/OS-KSCATALOG/v1.0"
    xmlns:atom="http://www.w3.org/2005/Atom">
    <token 
        id="aaaaa-bbbbb-ccccc-dddd" 
        expires="2012-04-13T13:15:00.000-05:00">
        <rax-auth:authenticatedBy>
            <rax-auth:credential>PASSWORD</rax-auth:credential>
        </rax-auth:authenticatedBy>
    </token>
    <user
        id="161418" 
        name="demoauthor" 
        rax-auth:defaultRegion="DFW" 
        rax-auth:domainId= "12345">
        <roles>
            <role id="3" name="identity:user-admin" 
                description="User Admin Role."/>
        </roles>
    </user>
    <serviceCatalog>
        <service type="rax:database" name="cloudDatabases">
            <endpoint region="DFW" tenantId="12345"
                publicURL="https://dfw.databases.api.rackspacecloud.com/v1.0/12345"/>
            <endpoint region="ORD" tenantId="12345"
                publicURL="https://ord.databases.api.rackspacecloud.com/v1.0/12345"/>
        </service>
        <service type="rax:load-balancer" name="cloudLoadBalancers">
            <endpoint region="ORD" tenantId="12345"
                publicURL="https://ord.loadbalancers.api.rackspacecloud.com/v1.0/12345"/>
            <endpoint region="DFW" tenantId="12345"
                publicURL="https://dfw.loadbalancers.api.rackspacecloud.com/v1.0/12345"/>
        </service>
        <service type="rax:object-cdn" name="cloudFilesCDN">
            <endpoint region="DFW" tenantId="MossoCloudFS_aaaa-bbbbbb-ccccc-ddddd"
                publicURL="https://cdn1.clouddrive.com/v1/MossoCloudFS_aaaa-bbbbbb-ccccc-ddddd"/>
            <endpoint region="ORD" tenantId="MossoCloudFS_aaaa-bbbbbb-ccccc-ddddd"
                publicURL="https://cdn2.clouddrive.com/v1/MossoCloudFS_aaaa-bbbbbb-ccccc-ddddd"/>
        </service>
        <service type="rax:monitor" name="cloudMonitoring">
            <endpoint tenantId="12345"
                publicURL="https://monitoring.api.rackspacecloud.com/v1.0/12345"/>
        </service>
        <service type="object-store" name="cloudFiles">
            <endpoint region="DFW" tenantId="MossoCloudFS_aaaa-bbbbbb-ccccc-ddddd"
                publicURL="https://storage101.dfw1.clouddrive.com/v1/MossoCloudFS_aaaa-bbbbbb-ccccc-ddddd"
                internalURL="https://snet-storage101.dfw1.clouddrive.com/v1/MossoCloudFS_aaaa-bbbbbb-ccccc-ddddd"/>
            <endpoint region="ORD" tenantId="MossoCloudFS_aaaa-bbbbbb-ccccc-ddddd"
                publicURL="https://storage101.ord1.clouddrive.com/v1/MossoCloudFS_aaaa-bbbbbb-ccccc-ddddd"
                internalURL="https://snet-storage101.ord1.clouddrive.com/v1/MossoCloudFS_aaaa-bbbbbb-ccccc-ddddd"/>
        </service>
        <service type="compute" name="cloudServers">
            <endpoint tenantId="12345"
                publicURL="https://servers.api.rackspacecloud.com/v1.0/12345">
                <version id="1.0" info="https://servers.api.rackspacecloud.com/v1.0"
                    list="https://servers.api.rackspacecloud.com/"/>
            </endpoint>
        </service>
        <service type="compute" name="cloudServersOpenStack">
            <endpoint region="DFW" tenantId="12345"
                publicURL="https://dfw.servers.api.rackspacecloud.com/v2/12345">
                <version id="2" info="https://dfw.servers.api.rackspacecloud.com/v2"
                    list="https://dfw.servers.api.rackspacecloud.com/"/>
            </endpoint>
            <endpoint region="ORD" tenantId="12345"
                publicURL="https://ord.servers.api.rackspacecloud.com/v2/12345">
                <version id="2" info="https://ord.servers.api.rackspacecloud.com/v2"
                    list="https://ord.servers.api.rackspacecloud.com/"/>
            </endpoint>
        </service>
        <service type="rax:dns" name="cloudDNS">
            <endpoint tenantId="12345"
                publicURL="https://dns.api.rackspacecloud.com/v1.0/12345"/>
        </service>
    </serviceCatalog>
</access>]]>
</programlisting>
	  </example>
		<example xml:id="json_auth_resp">
			<title>Service Catalog in Authentication Response: JSON</title>
			<programlisting>
<xi:include href="../samples/auth-annotated.json" parse="text"/>
		</programlisting>		
		</example>
<para><xref linkend="auth_attributes"></xref> describes the attributes for the authentication response.</para>
		<table rules="all" xml:id="auth_attributes">
			<caption>Authentication response attribute descriptions</caption>
			<col width="24%"/>
			<col width="76%"/>
			<thead>
				<tr>
					<th valign="top">Attribute</th>
					<th>Description</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>namespaces (<parameter>xmlns</parameter>)</td>
					<td>
						<para>In XML responses only, a list of
							namespaces identifies API extensions that
							add functionality to the core API. </para>
					</td>
				</tr>
				<tr>
					<td><parameter>token</parameter></td>
					<td>
						<para>This token can be presented to a service
							as evidence of authentication. Tokens are
							valid for a finite duration; a token's
							default lifespan is twenty-four hours. </para>
						<para>The token's <code>expires</code>
							attribute denotes the time after which the
							token will automatically become invalid.
							This attribute predicts the maximum
							lifespan for token validity but does not
							guarantee the token expiration time
							because a token can be revoked manually
							before it expires. Clients are encouraged
							to cache a token until it expires.</para>
					</td>
				</tr>
				<tr>
					<td><parameter>region</parameter></td>
					<td>
						<para> Users can be assigned a default region
							so that, when there is a choice between
							multiple endpoints associated with a
							service in the user's catalog, the
							endpoint for the user's default region
							will be selected if it is available. In
							this example, the user's default region is
							<code>DFW</code> and several of the
							services in the user's catalog offer
							endpoints in that region and the
							<code>ORD</code> region; this user's
							work will be directed to the
							<code>DFW</code> region whenever
							possible. </para>
					</td>
				</tr>
				<tr>
					<td><parameter>role</parameter></td>
					<td>
						<para> Users can be assigned multiple roles,
							with each role providing specific
							privileges. In this example,
							<code>joeuser</code> is the
							administrative user for the account,
							holding the fully-privileged
							<code>identity:user-admin</code> role.
							Other users might hold other roles with
							different privileges. Roles need not be
							associated with actual job functions such
							as Administrator, Operator, Developer,
							Tester, or Trainer. </para>
						<para>For information about roles, see
							<link xlink:href="Account-Users-d1e910.html">Identity user types and default roles</link></para>
					</td>
				</tr>
				<tr>
					<td><parameter>serviceCatalog</parameter></td>
					<td>
						<para> The service catalog lists the services
							this user can access. In this example, the
							user can access two compute services
							(Cloud Servers OpenStack and Cloud
							Servers) and two object storage services
							(Cloud Files Content Distribution Network
							(CDN), and Cloud Files), as well as one
							database service, one DNS service, one
							load balancing service, and one monitoring
							service. The catalog listing for each
							service provides at least one endpoint URL
							for that service. Other information, such
							as regions and versions and tenants, is
							provided if it's relevant to this user's
							access to this service. </para>
					</td>
				</tr>
				<tr>
					<td><parameter>service type</parameter></td>
					<td>
						<para> The service type attribute identifies
							services that perform similar functions,
							whatever those services might be named. In
							this example, the services named
							<literal>cloudServers</literal> and
							<literal>cloudServersOpenstack</literal>
							are both identified as
							<code>type="compute"</code>,
							identifying them as compute services even
							though the word "compute" does not appear
							in their names. </para>
						<important>
							<para> Use service type as the primary
								value for locating a service. If
								multiple endpoints of the same service
								type exist in the same region, use
								service name as the tiebreaker.</para>
						</important>
					</td>
				</tr>
				<tr>
					<td><code>service name</code></td>
					<td>
						<para> The service name attribute identifies
							each unique service in the catalog. Once a
							service is created, its name does not
							change. However, new services of the same
							service type may be added to the catalog
							with new names. </para>
						<important>
							<para> When you parse an authentication
								response programmatically, use
								<code>service type</code> rather
								than <code>service name</code> as the
								basis for determining whether a user
								has access to a particular kind of
								service. Service type is stable across
								all releases; new service types can be
								added, but existing service types are
								not renamed. In this example,
								<code>type="compute"</code>
								identifies all the available compute
								services, one of which is named
								cloudServers and one of which is named
								<literal>cloudServersOpenStack</literal>.
								New compute service names may be added
								in future releases; whatever the
								compute services are named, you can
								always recognize them by parsing for
								<code>type="compute"</code> in the
								authentication response's service
								catalog. </para>
						</important>
					</td>
				</tr>
				<tr>
					<td><parameter>endpoints</parameter></td>
					<td>
						<para>A service can expose endpoints in different regions as
							specified by the
							<parameter>region</parameter>
							attribute. Regional endpoints allow
							clients to provision resources in a manner
							that provides high availability. </para>
					</td>
				</tr>
				<tr>
					<td><parameter>tenantId</parameter></td>
					<td>
						<para>Some services recognize specification of a tenant. If a
							service does recognize tenants, the format
							of the tenant specification is defined
							only by the service; for details about
							whether and how to specify a tenant, check
							the documentation for the service you are
							using.</para>
					</td>
				</tr>
				<tr>
					<td><parameter>version</parameter></td>
					<td>Specifies the API version for the endpoint.
						The API version is also included in the URL to
						access the service.</td>
				</tr>
				<tr>
					<td valign="top">URLs (public and internal)</td>
					<td>
						<para> An endpoint can be assigned public and internal URLs. A
							public URL is accessible from anywhere.
							Access to a public URL usually incurs
							traffic charges. Internal URLs are only
							accessible to services within the same
							region. Access to an internal URL is free
							of charge.  The URL includes the API
							version and tenantId for services that
							require it.</para>
					</td>
				</tr>
			</tbody>
		</table>
		
		<section xml:id="Service_Types-d1e265">
			<title>Service Types in the Service Catalog</title>
			<para> As shown in <xref
					linkend="Sample_Request_Response-d1e64"/>, every
				service listed in the service catalog is associated
				with a service type. You can use the service type to
				recognize services that perform similar functions,
				whatever those services are named. The following table
				shows all the available service types and relates them
				to their corresponding OpenStack projects and those
				projects' documentation. </para>
			<table rules="all">
				<caption>Service Types</caption>
				<col width="24%"/>
				<col width="76%"/>
				<thead>
					<tr>
						<th>Service Type</th>
						<th>Description</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td><code>compute</code></td>
						<td>
							<para> Services of this type are
								compatible with the OpenStack Compute
								(Nova) API 1.1 as documented at <link
								xlink:href="http://nova.openstack.org/"
								>http://nova.openstack.org/</link>. </para>
							<para>
								<emphasis role="italic">Cloud Servers,
								a Rackspace service of this type,
								is documented at <link
								xlink:href="http://docs.rackspace.com/api/"
								>http://docs.rackspace.com/api/</link>.</emphasis>
							</para>
						</td>
					</tr>
					<tr>
						<td><code>identity</code></td>
						<td>
							<para> Services of this type are
								compatible with the OpenStack Keystone
								API 2.0 as documented at <link
								xlink:href="http://keystone.openstack.org/"
								>http://keystone.openstack.org/</link>. </para>
							<para>
								<emphasis role="italic">Cloud
								Identity, a Rackspace service of
								this type, is documented at <link
								xlink:href="http://docs.rackspace.com/api/"
								>http://docs.rackspace.com/api/</link>.</emphasis>
							</para>
						</td>
					</tr>
					<tr>
						<td><code>image-service</code></td>
						<td>
							<para> Services of this type are
								compatible with the OpenStack Glance
								API as documented at <link
								xlink:href="http://glance.openstack.org/"
								>http://glance.openstack.org/</link>. </para>
						</td>
					</tr>
					<tr>
						<td><code>object-store</code></td>
						<td>
							<para> Services of this type are
								compatible with the OpenStack Swift
								API as documented at <link
								xlink:href="http://swift.openstack.org/"
								>http://swift.openstack.org/</link>. </para>
							<para>
								<emphasis role="italic">Cloud Files, a
								Rackspace service of this type, is
								documented at <link
								xlink:href="http://docs.rackspace.com/api/"
								>http://docs.rackspace.com/api/</link>.</emphasis>
							</para>
						</td>
					</tr>
					<tr>
						<td><code>rax:database</code></td>
						<td>
							<para>
								<emphasis role="italic">Cloud Databases, a Rackspace service 
									of this type, is
									documented at <link
										xlink:href="http://docs.rackspace.com/api/"
										>http://docs.rackspace.com/api/</link>.</emphasis>
							</para>
						</td>
					</tr>
					<tr>
						<td><code>rax:dns</code></td>
						<td>
							<para>
								<emphasis role="italic">Cloud DNS, a
									Rackspace service of this type, is
									documented at <link
										xlink:href="http://docs.rackspace.com/api/"
										>http://docs.rackspace.com/api/</link>.</emphasis>
							</para>
						</td>
					</tr>
					<tr>
						<td><code>rax:load-balancer</code></td>
						<td>
							<para>
								<emphasis role="italic">Cloud Load
								Balancers, a Rackspace service of
								this type, is documented at <link
								xlink:href="http://docs.rackspace.com/api/"
								>http://docs.rackspace.com/api/</link>.</emphasis>
							</para>
						</td>
					</tr>
					<tr>
						<td><code>rax:monitor</code></td>
						<td>
							<para>
								<emphasis role="italic">Cloud
									Monitoring, a Rackspace service of
									this type, is documented at <link
										xlink:href="http://docs.rackspace.com/api/"
										>http://docs.rackspace.com/api/</link>.</emphasis>
							</para>
						</td>
					</tr>
					<tr>
						<td><code>rax:object-cdn</code></td>
						<td>
							<para>
								<emphasis role="italic">Cloud Files, a
								Rackspace service that supports a
								Content Distribution Network (CDN),
								is documented at <link xlink:href="http://docs.rackspace.com/api/">http://docs.rackspace.com/api/</link>.</emphasis>
							</para>
						</td>
					</tr>
				</tbody>
			</table>
		</section>
		<section xml:id="Sample_Catalog_Workflow-d1e266"><title>Suggested work flow for processing a Service Catalog Response</title>
			<para>When your client issues a successful authentication request,
				the Cloud Identity Service responds with a catalog that shows 
				the services available to that client, with
				one endpoint listed for each available service. (See 
					<xref linkend="Sample_Request_Response-d1e64"/> for a 
				service catalog example.)</para>
			<para>As the client developer, you must decide how your client
				should use the contents of its service catalog. The
				first step is to identify a service to which your
				client should be connected. Here is one possible
				work flow for processing the service catalog response
				to identify available services and their endpoints: </para>
			<orderedlist>
			<listitem>
					<para> 
						If the service catalog lists only one endpoint, use it.
						This endpoint connects your client to the only
						service available to that client.
					</para>
				</listitem>
				<listitem>
					<para> 
						If the service catalog lists multiple endpoints,
						you must establish a process for choosing an endpoint to connect your client to:
					</para>
					<orderedlist numeration="loweralpha">
						<listitem>
							<para> If the user has not specified which endpoint to use,
								generate an error.</para>
						</listitem>
						<listitem>
							<para> If the user has specified which endpoint to use, help
								the user identify that endpoint from
								within the catalog: </para>
							<orderedlist numeration="lowerroman">
								<listitem>
									<para>
										Support filtering by 
										endpoint name, service name, service type, region name, and version.
									</para>
								</listitem>
								<listitem>
									<para>
										Support manual specification of an endpoint via a URL parameter. 
									</para>
								</listitem>
							</orderedlist>
						</listitem>
					</orderedlist>
				</listitem>
			</orderedlist>
					<para>Authentication endpoints follow the process described
				above. </para>
			<para>
				To connect a client to an endpoint listed as
					<code>type="compute"</code>, do the following: 
			</para>
				<orderedlist>
					<listitem>
						<para>
							Go that compute service's endpoint and use its <code>WWW-Authenticate</code>
							header to determine what authentication server it uses.
						</para>
					</listitem>
					<listitem>
						<para>
							Go to that authentication server and authenticate.
						</para>
					</listitem>
					<listitem>
						<para>
							Return to the compute endpoint and proceed with using the compute service.
						</para>
					</listitem>
				</orderedlist>
		</section>
	</section>

