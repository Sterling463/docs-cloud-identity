<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE section [
<!ENTITY % common SYSTEM "../../common/common.ent">
%common;
]>
<section xmlns="http://docbook.org/ns/docbook"
    xmlns:xi="http://www.w3.org/2001/XInclude"
    xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0"
    xml:id="QuickStart-000">
    <?dbhtml stop-chunking?>
        <title>Quick Start</title>
        <para>Every ReST request against Rackspace Cloud APIs requires
        an authentication token generated by the &CIS;.</para>

    <para>To generate an authentication token, you issue an
        authentication request to the Rackspace Cloud Identity
        Service, an implementation of the OpenStack Keystone Identity
        Service v2.0.  In response to valid credentials, the Identity
        service returns an authentication token and a service catalog
        that includes a list of services with API endpoints that you
        can access with the supplied token.</para>
    
    <para>After you have the authentication token, you can use it to submit API requests to the available endpoints.
        Because the authentication token expires after 24 hours, you must generate a token once a day. </para>
    <para>The following sections describe how to authenticate, submit an API request, and manage authentication tokens.</para>
    <section 
        xmlns="http://docbook.org/ns/docbook"
        xmlns:xi="http://www.w3.org/2001/XInclude"
        xmlns:xsdxt="http://docs.rackspacecloud.com/xsd-ext/v1.0"
        xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0"
        xml:id="proc_generate_authtkn">
        <?dbhtml stop-chunking?>
        <title>Generate an authentication token</title>
        <orderedlist>
            <listitem>
                <para>Get your Rackspace Cloud credentials. <variablelist>
                    <varlistentry>
                        <term><code>username</code> and <code>password</code></term>
                        <listitem>
                            <para condition="client">The
                                <code>username</code> and
                                <code>password</code> are the same
                                credentials that you use to log in
                                to the <link xlink:href="https://mycloud.rackspace.com">Cloud Control panel</link>.</para>
                            <para condition="admin">The
                                <code>username</code> and
                                <code>password</code> are the ones
                                that the Identity team issued for
                                the service. If you do not have
                                these credentials, submit a ticket
                                to the Nebulous Operations team,
                                asking them to create a service account and provide credentials.</para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term><code>username</code> and
                            <code>APIKey</code></term>
                        <listitem>
                            <para>You can find your API key on
                                the <guilabel>Account
                                    Settings</guilabel> page in the
                                <link xlink:href="https://mycloud.rackspace.com">Cloud Control panel</link>. After
                                logging in, click your user ID. Then, select <guilabel>Account Settings</guilabel> from the
                                menu.</para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term><parameter>tenantId</parameter> or
                                   <parameter>tenantName</parameter>
                                (Optional)</term>
                        <listitem>
                            <para>Specify either the tenant ID
                                or the tenant name for the
                                specified user account.</para>
                            <para>Administrative users can also
                                authenticate by submitting
                                <parameter>tenantId</parameter> and
                                <parameter>token</parameter>
                                credentials. For details, see <link
                                    xlink:href="POST_authenticate_token_v2.0_tokens_Token_Calls.html"
                                    >Authenticate as tenant with
                                    token</link>.</para>
                        </listitem>
                    </varlistentry>
                </variablelist></para>
            </listitem>
            <listitem>
                <para>Choose either of the following
                   Identity service API endpoints to submit the
                    authentication request:<itemizedlist
                        spacing="compact">
                        <listitem>
                            <para>US endpoint: <link
                                xlink:href="&ENDPOINT-US;"
                                >&ENDPOINT-US;</link>. </para>
                        </listitem>
                        <listitem>
                            <para>UK endpoint: <link
                                xlink:href="&ENDPOINT-UK;"
                                >&ENDPOINT-UK;</link>. </para>
                        </listitem>
                    </itemizedlist></para>
            </listitem>
            <listitem>
                <para>Submit a <command>POST tokens</command>
                    request with valid credentials to the
                    chosen endpoint as shown in the following
                    <link
                        xlink:href="http://curl.haxx.se/"
                        >cURL</link> example: <itemizedlist>
                            <listitem>
                                <para>Use your
                                    <parameter>username</parameter> and
                                    <parameter>password</parameter>:</para>
                                <programlisting language="bash" role="gutter: false"><?db-font-size 60%?><prompt>$</prompt> curl https://identity.api.rackspacecloud.com/v2.0/tokens  \
 -X POST \
 -d '{"auth":{"passwordCredentials":{"username":"theUserName","password":"thePassword"}}}' \
 -H "Content-type: application/json"</programlisting>
                            </listitem>
                            <listitem>
                                <para>Use your
                                    <parameter>username</parameter> and
                                    <parameter>API
                                        key</parameter>:</para>
                                <programlisting language="bash" role="gutter: false"><?db-font-size 60%?><prompt>$</prompt> curl https://identity.api.rackspacecloud.com/v2.0/tokens  \
 -X POST \
 -d '{"auth":{"RAX-KSKEY:apiKeyCredentials"{"username":"myUserName","apiKey":"thePassword"}}}' \
 -H "Content-type: application/json"</programlisting>
                            </listitem>
                        </itemizedlist></para>
            </listitem>
            <listitem>
                <para>Review the <link
                    xlink:href="Sample_Request_Response-d1e64.html"
                    xlink:show="new">authentication
                    response</link> which includes a token
                    object, a service catalog with available
                    API endpoints, and user
                    information.</para>
                <itemizedlist>
                    <listitem>
                        <para>If the request is successful,
                            locate the token ID in the
                            <parameter>token</parameter> object
                            and save it, or export it to an
                            environment variable to include in
                            subsequent requests to Rackspace
                            Cloud service API endpoints.
                            <screen><computeroutput>"token": 
      {
        "RAX-AUTH:authenticatedBy": [
            "PASSWORD"
                ],
        "expires": "2014-01-09T15:08:53.645-06:00",
        "id": "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
      }</computeroutput></screen></para>
                    </listitem>
                    <listitem>
                        <para>If your account is enabled for
                            multi-factor authentication, the
                            Identity service sends an SMS
                            message with a passcode to the
                            phone associated with your account
                            and returns a 401 message that
                            includes a <code>sessionId</code>
                            in the
                            <parameter>WWW-Authenticate</parameter>
                            header.</para>
                        <screen><computeroutput>
&lt; HTTP/1.1 401 Unauthorized
* Server Apache-Coyote/1.1 is not blacklisted
&lt; Server: Apache-Coyote/1.1
&lt; vary:  Accept, Accept-Encoding, X-Auth-Token
&lt; WWW-Authenticate: OS-MF sessionId='APU9ymMBWY5W-pTgnHuZEvjKsM5oG_ler4lC0g_EkCPYvPdUBHK55RWtsgpL5RZ22AyDNaVCNCz6mlDOwbJAI-RLFQywI7CgOvjH0MLhL5a6D-c4cd1x8BbZmy8uT8ejm7jzBUX_vDZ5R0Hcia5DkOB80yWNJ8XVKMxVYLg5Qwp0TPA2zx-HQOTM3xqVQE63u1mYDUqikrXQ', factor='PASSCODE'
&lt; Content-Type: application/json
&lt; Transfer-Encoding: chunked
&lt; Date: Thu, 13 Mar 2XXX 21:10:50 GMT
{ [data not shown]
100   186    0    96  100    90    159    149 --:--:-- --:--:-- --:--:--   159
* Connection #0 to host identity.api.rackspacecloud.com/v2.0 left intact
{
"unauthorized": {
    "code": 401,
    "message": "Additional authentication credentials required."
    }
}
    {
    "key":"value"
    } </computeroutput></screen>
                        <para>To complete the authentication
                            process,  submit a second
                            <command>POST tokens</command>
                            authentication request that
                            includes the
                            <parameter>sessionId</parameter>
                            and multi-factor authentication
                            <parameter>passcode</parameter>
                            from your
                            phone:<programlisting language="bash" role="gutter: false"><?db-font-size 60%?><prompt>$</prompt>curl https://identity.api.rackspacecloud.com/v2.0/tokens \
       -X POST \
       -d '{"auth": {"RAX-AUTH:passcodeCredentials": {"passcode":"1411594"}}}'\
       -H "X-SessionId: $SESSION_ID" \
       -H "Content-Type: application/json" --verbose -k</programlisting>The
                            authentication response returns the
                            authentication token ID and the
                            service catalog with a list of
                            available services. Save the token
                            ID or export it to an environment
                            variable to include in subsequent
                            requests to Rackspace Cloud service
                            API endpoints.</para>
                    </listitem>
                </itemizedlist>
            </listitem>
        </orderedlist>
    </section>
    <section 
        xmlns="http://docbook.org/ns/docbook"
        xmlns:xi="http://www.w3.org/2001/XInclude"
        xmlns:xsdxt="http://docs.rackspacecloud.com/xsd-ext/v1.0"
        xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0"
        xml:id="submit_API_request">
        <?dbhtml stop-chunking?>
        <title>Submit an API request to a Rackspace
            Cloud service</title>
        <para>This procedure supplies a sample API request against the Rackspace Cloud Identity service. You can submit API requests to any endpoint included in the 
        service catalog returned in the authentication response body.</para>
        <orderedlist>
            <listitem>
                <para>Copy the token ID from the
                    authentication response. </para>
                <para>You can export the value to an
                    environment variable that can be
                    supplied in the
                    <parameter>X-Auth-Token</parameter>
                    header for each API request.</para>
            </listitem>
            <listitem>
                <para>Use the service catalog returned in the
                    authentication response to find URL for the API
                    service that you want to use.</para>
                <para>For example, the endpoint for Cloud Files is
                        <code>https://storage101.ord1.clouddrive.com/v1/MossoCloudFS_9c24e3db-52bf-4f26-8dc1-220871796e9f/</code>
                    where
                        <code>MossoCloudFS_9c24e3db-52bf-4f26-8dc1-220871796e9f</code>
                    is the tenant ID for your Cloud Files
                    service.</para>
            </listitem>
            <listitem>
                <para>Submit an API request to the API service
                    endpoint.</para>
                <para>The following example shows a cURL request
                    against the Cloud Files API to retrieve a list of
                    CDN-enabled containers for the tenant.
                    <programlisting language="bash" role="gutter: false"><?db-font-size 60%?><prompt>$</prompt> cURL -i -s \
-X GET https://storage101.ord1.clouddrive.com/v1/MossoCloudFS_9c24e3db-52bf-4f26-8dc1-220871796e9f \
-H "X-Auth-Token: zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz" \
-H "Content-type: application/json"  --verbose -k</programlisting></para>
                <para>The Cloud Files CDN service returns the following response if the authentication token is accepted.</para>
                <para><programlisting>
<![CDATA[&gt; GET /v1/MossoCloudFS_9c24e3db-52bf-4f26-8dc1-220871796e9f HTTP/1.1
> User-Agent: curl/7.30.0
> Host: storage101.ord1.clouddrive.com
> Accept: */*
> X-Auth-Token: 69dc089d983f4729af29bec5a7dc6426
> Content-type: application/json
>
< HTTP/1.1 200 OK
HTTP/1.1 200 OK
< Content-Length: 22
Content-Length: 22
< X-Account-Object-Count: 0
X-Account-Object-Count: 0
< X-Account-Storage-Policy-Policy-0-Bytes-Used: 0
X-Account-Storage-Policy-Policy-0-Bytes-Used: 0
< X-Timestamp: 1345588196.72805
X-Timestamp: 1345588196.72805
< X-Account-Storage-Policy-Policy-0-Object-Count: 0
X-Account-Storage-Policy-Policy-0-Object-Count: 0
< X-Account-Meta-Temp-Url-Key: e1f97840118eafc550d45dbd8e530c11
X-Account-Meta-Temp-Url-Key: e1f97840118eafc550d45dbd8e530c11
< X-Account-Bytes-Used: 0
X-Account-Bytes-Used: 0
< X-Account-Container-Count: 3
X-Account-Container-Count: 3
< Content-Type: text/plain; charset=utf-8
Content-Type: text/plain; charset=utf-8
< Accept-Ranges: bytes
Accept-Ranges: bytes
< X-Trans-Id: tx1353de66dd9d49da84eda-00544799f4ord1
X-Trans-Id: tx1353de66dd9d49da84eda-00544799f4ord1
< Date: Wed, 22 Oct 2014 11:50:12 GMT
Date: Wed, 22 Oct 2014 11:50:12 GMT

<
metest
mytest
mytest2
* Connection #0 to host storage101.ord1.clouddrive.com left intact
                    ]]>
                </programlisting></para>
            </listitem>
        </orderedlist>
    </section>
    <section 
        xmlns="http://docbook.org/ns/docbook"
        xmlns:xi="http://www.w3.org/2001/XInclude"
        xmlns:xsdxt="http://docs.rackspacecloud.com/xsd-ext/v1.0"
        xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0"
        xml:id="manage_auth_tokens">
        <title>Manage authentication tokens</title>
        <para>An authentication token is valid for 24-hours by
            default. The expiration date and time are provided
            in the token object of the authentication
            response. If you re-authenticate before the token
            expiration, the Identity service returns the same
            token as long as it remains valid.</para>
        <para>When the token expires, any API request submitted
            against Rackspace Cloud services returns a
            <literal>401 Unauthorized error</literal>. To
            regain access, submit another <command>POST
                tokens</command> request to the authentication
            endpoint. </para>
        <para>When developing applications, make sure your
            code includes logic to cache tokens, check for
            expired tokens, and submit another authentciation
            request when required.</para>
        <para>Identity administrators can use the Revoke token
            operation to delete an existing token if
            necessary.</para>
        <tip condition="admin">
            <para>If you re-authenticate within the last hour
                before token expiration, the Identity service
                issues a new authentication token before the
                existing token expires. Note that this
                behavior is a Rackspace customization of the
                OpenStack Keystone implementation.</para>
        </tip>
    </section>
    <section 
        xmlns="http://docbook.org/ns/docbook"
        xmlns:xi="http://www.w3.org/2001/XInclude"
        xmlns:xsdxt="http://docs.rackspacecloud.com/xsd-ext/v1.0"
        xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0"
        xml:id="auth_learn_more">
    <?dbhtml stop-chunking?>
    <title>Learn more</title>
    <para>Visit the following links to learn more about &CIS;.</para>
    <para>
        <itemizedlist>
            <listitem>
                <para><link xlink:href="Token_Calls.html"
                        >Authentication tokens</link></para>
            </listitem>
            <listitem>
                <para>
                    <link xlink:href="Identity-Concpts.html">Identity concepts</link>
                    </para>
            </listitem>
            <listitem>
                <para>
                <link xlink:href="Sample_Request_Response-d1e64.html">Sample authentication request and response</link>
                </para>
            </listitem>
            <listitem>
                <para>
                    <link xlink:href="API_Operations.html">&CIS; API operations reference</link>
                </para>
            </listitem>
            <listitem>
                <para>
                    <link xlink:href="http://docs-internal.rackspace.com/">API operations references for other Rackspace services</link>
                </para>
            </listitem>
            <listitem condition="admin">
                <para>
                    <link xlink:href="http://docs.rackspace.com">API operations reference for other Rackspace services (Internal documentation)</link>
                </para>
            </listitem>
        </itemizedlist>
    </para>
    <tip>
        <para>You can find language binding examples that can be modified to work with the Cloud
            Identity service in the <link
                xlink:href="http://docs.rackspace.com/sdks/guide/content/intro.html">Rackspace
                Software Development Kits</link>.</para>
    </tip>
    </section>
    <!-- <para security="writeronly"> -->
        <!--  added then deleted this preparatory to 2012-05-16 republication; 
             leaving it hidden while people think -->
        <!-- Some of the operations described in this API Developer Guide
        are possible because we have implemented extensions to the
        core Identity API. Extensions are particularly relevant to
        operations on  <olink
            targetdoc="Identity-Admin-Developer-Guide"
            targetptr="Group_Calls">“Groups”</olink>, <olink
            targetdoc="Identity-Admin-Developer-Guide"
            targetptr="Impersonation_Calls">“Impersonations”</olink>,
            <olink targetdoc="Identity-Admin-Developer-Guide"
            targetptr="Role_Calls">“Roles”</olink>, <olink
            targetdoc="Identity-Admin-Developer-Guide"
            targetptr="Secret_Calls">“Secret Questions and
            Answers”</olink>, <olink
            targetdoc="Identity-Admin-Developer-Guide"
            targetptr="Token_Calls">“Tokens”</olink>, and  <olink
            targetdoc="Identity-Admin-Developer-Guide"
            targetptr="User_Calls">“Users”</olink>. </para> -->
    </section>
