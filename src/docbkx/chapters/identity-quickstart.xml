<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE section [
<!ENTITY % common SYSTEM "../../common/common.ent">
%common;
]>
<chapter xmlns="http://docbook.org/ns/docbook" 
    xmlns:xi="http://www.w3.org/2001/XInclude"
    xmlns:xsdxt="http://docs.rackspacecloud.com/xsd-ext/v1.0"
    xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:id="QuickStart-000">
    <?dbhtml stop-chunking?>
 <title>Quickstart</title>
 <para>Every ReST request against Rackspace Cloud
        APIs requires an authentication token generated by the
        &CIS;.</para>
    <para>You obtain a token by submitting an authentication request with valid credentials to the
        Rackspace Cloud Identity Service. The Identity service returns a response that includes an
        authentication token, user information and role assignments, and a service catalog with
        information about the available services. </para>
    <para>With a valid token, you can submit API requests to any of the API service endpoints
        included in the service catalog. A token is only valid for 24 hours, which means that you must 
        generate a new token each day.
    </para>
    <para>Use this Quick Start to learn how to authenticate and submit API requests and to manage
        authentication tokens for Rackspace Cloud accounts. The instructions use cURL commands to
        provide direct access to the Cloud service API. The <link xlink:href="curl.html">cURL</link> command line tool is useful for running, testing, and
        troubleshooting individual API operations.</para>
    <tip>
        <itemizedlist>
        <listitem>
            <para>If you are developing applications or automation for Rackspace Cloud services, try
                    interacting with the Rackspace Cloud API services by using <link
                        xlink:href="https://developer.rackspace.com/sdks/">Rackspace SDKs</link> or
                        <link xlink:href="https://wiki.openstack.org/wiki/OpenStackClients"
                        >OpenStack client</link> applications </para>
        </listitem>
            <listitem>
            <para>For API testing and workflow management in a graphical environment, try interacting with the 
                API by using an application such as <link xlink:href="http://www.getpostman.com">Postman</link> or <link
                    xlink:href="https://addons.mozilla.org/en-US/firefox/addon/restclient">ReST client
                    for Firefox</link>.
            </para>
        </listitem>
    </itemizedlist></tip>
    
    <section
        xmlns="http://docbook.org/ns/docbook"
        xmlns:xi="http://www.w3.org/2001/XInclude"
        xmlns:xsdxt="http://docs.rackspacecloud.com/xsd-ext/v1.0"
        xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0"
        xml:id="proc_generate_authtkn">
        <?dbhtml stop-chunking?>
        <title>Generate an authentication token</title>
        <orderedlist>
            <listitem>
                <para>Get your Rackspace Cloud credentials. <variablelist>
                        <varlistentry>
                            <term><code>username</code> and
                                   <code>password</code></term>
                            <listitem>
                                <para condition="client">The
                                   <code>username</code> and
                                   <code>password</code> are the same
                                   credentials that you use to log in
                                   to the <link
                                   xlink:href="https://mycloud.rackspace.com"
                                   >Cloud Control panel</link>.</para>
                                <para condition="admin">The
                                   <code>username</code> and
                                   <code>password</code> are the ones
                                   that the Identity team issued for
                                   the service. If you do not have
                                   these credentials, submit a ticket
                                   to the Nebulous Operations team,
                                   asking them to create a service
                                   account and provide
                                   credentials.</para>
                            </listitem>
                        </varlistentry>
                        <varlistentry>
                            <term><code>username</code> and
                                   <code>APIKey</code></term>
                            <listitem>
                                <para>You can find your API key on the
                                   <guilabel>Account
                                   Settings</guilabel> page in the
                                   <link
                                   xlink:href="https://mycloud.rackspace.com"
                                   >Cloud Control panel</link>. After
                                   logging in, click your user ID.
                                   Then, select <guilabel>Account
                                   Settings</guilabel> from the
                                   menu.</para>
                            </listitem>
                        </varlistentry>
                        <varlistentry>
                            <term><parameter>tenantId</parameter> or
                                   <parameter>tenantName</parameter>
                                (optional)</term>
                            <listitem>
                                <para>Specify either the tenant ID or
                                   the tenant name for the specified
                                   user account.</para>
                                <para>Administrative users can also authenticate by using <link
                                        xlink:href="POST_authenticate_token_v2.0_tokens_Token_Calls.html"
                                        > Tenant ID and token credentials</link>.</para>
                            </listitem>
                        </varlistentry>
                    </variablelist></para>
            </listitem>
            <listitem>
                <para>Submit a <command>POST tokens</command> request
                    with valid credentials to the Identity service API endpoint as
                    shown in this <link
                        xlink:href="http://curl.haxx.se/">cURL</link>
                    example: <itemizedlist>
                        <listitem>
                            <para>Use your
                                   <parameter>username</parameter> and
                                   <parameter>password</parameter>:</para>
                            <programlisting language="bash" role="gutter: false"><?db-font-size 60%?><prompt>$</prompt> curl https://identity.api.rackspacecloud.com/v2.0/tokens  \
 -X POST \
 -d '{"auth":{"passwordCredentials":{"username":"theUserName","password":"thePassword"}}}' \
 -H "Content-type: application/json" | python -m json.tool</programlisting>
                        </listitem>
                        <listitem>
                            <para>Use your
                                   <parameter>username</parameter> and
                                   <parameter>API
                                key</parameter>:</para>
                            <programlisting language="bash" role="gutter: false"><?db-font-size 60%?><prompt>$</prompt> curl https://identity.api.rackspacecloud.com/v2.0/tokens  \
 -X POST \
 -d '{"auth":{"RAX-KSKEY:apiKeyCredentials"{"username":"myUserName","apiKey":"thePassword"}}}' \
 -H "Content-type: application/json" | python -m json.tool</programlisting>
                        </listitem>
                    </itemizedlist></para>
            </listitem>
            <listitem>
                <para>Check the <link xlink:href="Sample_Request_Response-d1e64.html"
                        xlink:show="new">authentication response</link>.</para>
                <itemizedlist>
                    <listitem>
                        <para>If the request is successful, use the information in the authentication response to 
                            <xref linkend ="submit_API_request"/>.</para>
                    </listitem>
                    <listitem>
                        <para>If the request is not successful, review the message in the response
                            to determine next steps. </para>
                        <table rules="all" width="100%">
                            <caption>Authentication error messages</caption>
                            <col width="13%"/>
                            <col width="87%"/>
                            <thead>
                                <tr>
                                    <td>Error</td>
                                    <td>Action</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr align="left" condition="admin">
                                    <td><code>401</code></td>
                                    <td><para><code>message: Additional authentication credentials required.</code></para>
                                        <para>You are requesting authentication for an account that
                                            requires <link
                                                xlink:href="http://docs.rackspace.com/auth/api/v2.0/auth-client-devguide/content/proc_mfa_auth.html"
                                                >multi-factor authentication</link>. To
                                            complete the authentication process, submit a second
                                                <guilabel>POST tokens</guilabel> request with these
                                            credentials: <itemizedlist>
                                                <listitem>
                                                    <para>The session ID value returned in the <code>WWW-Authenticate: OS-MF
                                                        sessionId</code> header parameter included in the 
                                                        response to the initial authentication
                                                        request.</para>
                                                </listitem>
                                                <listitem>
                                                  <para>The passcode from the mobile phone
                                                  associated with your user account.</para>
                                                    <example><title>Authentication request with multi-factor authentication credentials</title>
                                                        <programlisting language="bash" role="gutter: false"><?db-font-size 60%?><prompt>$</prompt>curl https://identity.api.rackspacecloud.com/v2.0/tokens \
       -X POST \
       -d '{"auth": {"RAX-AUTH:passcodeCredentials": {"passcode":"1411594"}}}'\
       -H "X-SessionId: $SESSION_ID" \
       -H "Content-Type: application/json" --verbose | python -m json.tool</programlisting></example>
                                                </listitem>
                                            </itemizedlist>
                                            </para>
                                 </td>
                                </tr>
                                <tr>
                                    <td><code>401</code></td>
                                    <td><para><code>message:  Unable to authenticate user with credentials
                                        provided.</code></para>
                                        <para>Verify the authentication credentials submitted in the authentication request. If necessary, contact your Rackspace Cloud Administrator or Rackspace Support 
                                    to get valid credentials.</para></td>
                                </tr>
                                <tr security="writeronly">
                                    <td><code>403</code></td>
                                    <td><para><code>message: setup-mfa: You must first enable multifactor for
                                        this account. Please request a scoped setup-mfa token to
                                        setup MFA on your account.</code></para>
                                        <para>Your Rackspace Cloud environment requires users to authenticate by using multi-factor
                                            authentication.</para></td>
                                </tr>
                                <tr>
                                    <td><code>400</code></td>
                                    <td><para><code>message: Invalid request body: unable to parse Auth data.
                                        Please review XML or JSON formatting.</code></para>
                                        <para>Review the authentication request for syntax or coding
                                            errors. If you are using cURL, see <link
                                                xlink:href="curl.html">How cURL commands
                                            work</link>.</para></td>
                                </tr>
                            </tbody>
                        </table>
                    </listitem>
                </itemizedlist>
            </listitem>
        </orderedlist>
    </section>
    
    <section xmlns="http://docbook.org/ns/docbook"
        xmlns:xi="http://www.w3.org/2001/XInclude"
        xmlns:xsdxt="http://docs.rackspacecloud.com/xsd-ext/v1.0"
        xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0"
        xml:id="submit_API_request" xreflabel="submit an API request">
        <?dbhtml stop-chunking?>
        <title>Submit an API request to a Rackspace Cloud
            service</title>
        <para>After you authenticate successfully, use the information in the <link
                xlink:href="Sample_Request_Response-d1e64.html#annotated_auth_resp">authentication
                response</link> to submit an API request for any service included in the service
            catalog. </para>
        <orderedlist>
            <listitem>
                <para>In the authentication response, find the token ID in the
                        <parameter>token</parameter> object and save it, or export it to an
                    environment variable that can be supplied in the
                        <parameter>X-Auth-Token</parameter> header required by each API
                    request.</para><screen><computeroutput>"token": 
      {
        "RAX-AUTH:authenticatedBy": [
            "PASSWORD"
                ],
        "expires": "2014-01-09T15:08:53.645-06:00",
        "id": "123abc5368901230076b12357897898"
      }</computeroutput></screen>
            </listitem>
            <listitem>
                <para>Identify the endpoint URL for the service you want to access. </para>
                <para>For example, the endpoint for Cloud Files is
                            <code>https://storage101.ord1.clouddrive.com/v1/<replaceable>yourTenantID</replaceable></code>. </para>
            </listitem>
            <listitem>
                <para>Submit an API request to the service endpoint that you identified.</para>
                <para>This example shows a cURL request to retrieve a list of containers for a
                    tenant by using he Cloud Files
                    API.<programlisting language="bash" role="gutter: false"><?db-font-size 60%?><prompt>$</prompt> cURL -i -s \
-X GET https://storage101.ord1.clouddrive.com/v1/MossoCloudFS_9c24e3db-52bf-4f26-8dc1-220871796e9f \
-H "X-Auth-Token: $AUTH_TOKEN" \
-H "Content-type: application/json"  --verbose | python -m json.tool</programlisting></para>
                <para>The Cloud Files service returns the
                    following response if the authentication token is
                    accepted.</para>
                <screen>
                <computeroutput>
                    > GET /v1/MossoCloudFS_9c24e3db-52bf-4f26-8dc1-220871796e9f HTTP/1.1
                    > User-Agent: curl/7.30.0
                    > Host: storage101.ord1.clouddrive.com
                    > Accept: */*
                    > X-Auth-Token: 69dc089d983f4729af29bec5a7dc6426
                    > Content-type: application/json
                    >
                    HTTP/1.1 200 OK 
                    Content-Length: 22
                    X-Account-Object-Count: 0
                    X-Account-Storage-Policy-Policy-0-Bytes-Used: 0
                    X-Timestamp: 1345588196.72805
                    X-Account-Storage-Policy-Policy-0-Object-Count: 0
                    X-Account-Meta-Temp-Url-Key: e1f97840118eafc550d45dbd8e530c11
                    X-Account-Bytes-Used: 0
                    X-Account-Container-Count: 3
                    Content-Type: text/plain; charset=utf-8
                    Accept-Ranges: bytes
                    X-Trans-Id: tx1353de66dd9d49da84eda-00544799f4ord1
                    Date: Wed, 22 Oct 2014 11:50:12 GMT
                    
                    metest
                    mytest
                    mytest2
                    * Connection #0 to host storage101.ord1.clouddrive.com left intact
                </computeroutput>  
                </screen>
            </listitem>
        </orderedlist>
    </section>
    <section xmlns="http://docbook.org/ns/docbook"
        xmlns:xi="http://www.w3.org/2001/XInclude"
        xmlns:xsdxt="http://docs.rackspacecloud.com/xsd-ext/v1.0"
        xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0"
        xml:id="manage_auth_tokens">
        <title>Manage authentication tokens</title>
        <para>Authentication tokens are valid for 24 hours by default. The expiration time stamp is
            included in the token object returned in the authentication response. Administrators and
            users can invalidate a token immediately by submitting a <guilabel>Revoke
                token</guilabel> API request to the Identity service endpoint.</para>
        <para>If you re-authenticate before the token expires, the
            Identity service returns the same token as long as it
            remains valid. </para>
        <para>When a token expires or becomes invalid, any API request submitted against Rackspace
            Cloud services returns a 401 error message. To regain access, submit another
                <command>POST tokens</command> request to the authentication endpoint.</para>
        <para>
            <variablelist>
                <varlistentry>
                    <term><emphasis role="bold">Best
                            practices</emphasis></term>
                    <listitem>
                        <itemizedlist>
                            <listitem>
                                <para>Cache authentication
                                   tokens.</para>
                                <para>By default, the Rackspace Cloud
                                   Identity service makes an
                                   authentication request before every
                                   API call. </para>
                                <para>To speed up your API operations and reduce system load, store
                                    the authentication token in a secure cache or database so that
                                    the API can use the stored information, instead of having to
                                    re-authenticate for each API request. You can re-use the cached
                                    token value as long as it remains valid. </para>
                            </listitem>
                            <listitem>
                                <para>Design applications to re-authenticate after receiving a
                                        <code>401 Unauthorized</code> response from a service
                                    endpoint, or use either of these methods to  get a new token
                                    before the existing token expires.<itemizedlist>
                                        <listitem>
                                            <para>Submit a <command>POST tokens</command> request
                                                within an hour of the token expiration to obtain a
                                                new token. Note that this behavior is a Rackspace
                                                customization of the OpenStack Keystone
                                                implementation.</para>
                                        </listitem>
                                        <listitem>
                                            <para>Submit a <command>DELETE token</command> request
                                                to revoke the existing token followed by a
                                                  <command>POST tokens</command> request to get a
                                                new token.</para>
                                        </listitem>
                                    </itemizedlist></para>
                            </listitem>
                             <listitem>
                                <para>To simplify authentication,
                                   credential, and token management,
                                   use an <link
                                   xlink:href="https://wiki.openstack.org/wiki/OpenStackClients"
                                   >OpenStack command-line client
                                   application</link> or one of the
                                   <link
                                   xlink:href="https://developer.rackspace.com/sdks/"
                                   >Rackspace SDKs</link>. </para>
                            </listitem>
                        </itemizedlist>
                    </listitem>
                </varlistentry>
            </variablelist>
        </para>
    </section>
    <section xmlns="http://docbook.org/ns/docbook"
        xmlns:xi="http://www.w3.org/2001/XInclude"
        xmlns:xsdxt="http://docs.rackspacecloud.com/xsd-ext/v1.0"
        xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0"
        xml:id="auth_learn_more">
        <?dbhtml stop-chunking?>
        <title>Learn more</title>
        <para>Visit the following links to learn more about
            &CIS;.</para>
        <para>
            <itemizedlist>
                <listitem>
                    <para><link xlink:href="Token_Calls.html"
                            >Authentication tokens</link></para>
                </listitem>
                <listitem>
                    <para>
                        <link xlink:href="Identity-Concpts.html"
                            >Identity concepts</link>
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <link
                            xlink:href="Sample_Request_Response-d1e64.html"
                            >Sample authentication request and
                            response</link>
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <link xlink:href="API_Operations.html">&CIS;
                            API operations reference</link>
                    </para>
                </listitem>
                <listitem>
                    <para>
                        <link
                            xlink:href="http://docs-internal.rackspace.com/"
                            >API operations references for other
                            Rackspace services</link>
                    </para>
                </listitem>
                <listitem condition="admin">
                    <para>
                        <link xlink:href="http://docs.rackspace.com"
                            >API operations reference for other
                            Rackspace services (Internal
                            documentation)</link>
                    </para>
                </listitem>
            </itemizedlist>
        </para>
        <tip>
            <para>You can find language binding examples that can be
                modified to work with the Cloud Identity service in
                the <link
                    xlink:href="http://docs.rackspace.com/sdks/guide/content/intro.html"
                    >Rackspace Software Development
                Kits</link>.</para>
        </tip>
  <!-- <para security="writeronly"> --><!--  added then deleted this preparatory to 2012-05-16 republication; 
             leaving it hidden while people think --><!-- Some of the operations described in this API Developer Guide
        are possible because we have implemented extensions to the
        core Identity API. Extensions are particularly relevant to
        operations on  <olink
            targetdoc="Identity-Admin-Developer-Guide"
            targetptr="Group_Calls">“Groups”</olink>, <olink
            targetdoc="Identity-Admin-Developer-Guide"
            targetptr="Impersonation_Calls">“Impersonations”</olink>,
            <olink targetdoc="Identity-Admin-Developer-Guide"
            targetptr="Role_Calls">“Roles”</olink>, <olink
            targetdoc="Identity-Admin-Developer-Guide"
            targetptr="Secret_Calls">“Secret Questions and
            Answers”</olink>, <olink
            targetdoc="Identity-Admin-Developer-Guide"
            targetptr="Token_Calls">“Tokens”</olink>, and  <olink
            targetdoc="Identity-Admin-Developer-Guide"
            targetptr="User_Calls">“Users”</olink>. </para> -->
    </section>
</chapter>
